!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.DCAgent={})}(this,function(e){"use strict";var t,n={get reset(){return k},get cancel(){return X},get stop(){return j},get run(){return B},get set(){return K}},r={get isDebug(){return v},get noop(){return _},get isFunction(){return y},get isObject(){return S},get log(){return A},get tryThrow(){return N},get uuid(){return L},get extend(){return O},get attempt(){return R},get isLocalStorageSupported(){return D},get repeat(){return C},get padding(){return U},get aspect(){return w},get getHostName(){return M},get hiddenProperty(){return P},get slice(){return V},get parseInt(){return G},get max(){return b},get jsonStringify(){return F},get jsonParse(){return H}},o={get getOnlineInfo(){return ve},get collect(){return _e},get clear(){return ye},get saveToStorage(){return st},get loadFromStorage(){return ct},get addError(){return gt},get addEvent(){return dt}},i={get REQUEST_TIME_OUT(){return J},get MAX_ONLINE_TIME(){return W},get MIN_ONLINE_INTERVAL(){return $},get UID_MIN_LENGTH(){return Z},get ASAP_TIMEOUT(){return ee},get MAX_ERROR_COUNT(){return te},get DEFAULT_AGE(){return ne},get DEFAULT_GENDER(){return re},get DEFAULT_ROLE_LEVEL(){return oe},get DEFAULT_NET_TYPE(){return ie},get DEFAULT_PLATFORM(){return ae}},a={get HOST(){return Se},get CREATE_TIME(){return Ae},get EGRET_PREFIX(){return Ne},get LAYA_PREFIX(){return Le},get COCOS_PREFIX(){return Oe},get UNKNOW_ENGINE(){return Re},get PARENT_KEY(){return De},get EVENTS_KEY(){return Ce},get ERRORS_KEY(){return Ue},get CLIENT_KEY(){return we},get QUIT_SNAPSHOT(){return Me},get LOGOUT_TIME(){return xe},get API_PATH(){return Pe},get PADDING_STRING(){return Ve},get REQ_KEY(){return Ge},get USER_INIT_BASE_SETTINGS(){return be},get ACCOUNT_RELATED_SETTINGS(){return Fe},get ACCOUNT_ROLE_SETTINGS(){return He},get EVT_COIN(){return ke},get EVT_ITEM(){return Xe},get EVT_LEVEL(){return je},get EVT_MISSION(){return Be},get EVT_TASK(){return Ke},get EVT_PV(){return Ye}},u={get setUID(){return rt},get getUID(){return ot},get setItem(){return it},get getItem(){return at},get removeItem(){return ut}},s={get hasStorage(){return Qe},get isStandardBrowser(){return ze},get hasCookie(){return Je},get protocol(){return $e},get useXDR(){return Ze},get device(){return Ie}},c={get isParamsValid(){return St},get shouldBeInited(){return At},get shouldBeLoggedIn(){return Nt},get shouldNotBeDestoryed(){return Lt}},g={get API_PATH(){return Rt},get appendOnline(){return Dt},get appendEcho(){return Ct}},d={get setPollingDebounce(){return wt}},l={get engine(){return I},get default(){return z}},p={inited:!1},f=(0,eval)("this"),T=f||{},E=T.setTimeout,m=T.clearTimeout,I={isEgret:!!T.egret,isLayabox:!!T.layabox,isCocos:!!T.cc&&!!T.cc.game};I.isEgret&&!E&&(E=function(e,t){T.egret.setTimeout(e,T,t)},m=function(e){T.egret.clearTimeout(e)});var h=Object.prototype.toString,v=T.DCAGENT_DEBUG_OPEN;function _(){}function y(e){return"function"==typeof e}function S(e){return e&&"[object Object]"===h.call(e)}function A(e){}var N=v?function(e){throw new Error(e)}:function(e){};function L(e){var t,n;return t=Date.now(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n;return n=(t+16*Math.random())%16|0,t=Math.floor(t/16),"x"===e?n.toString(16):(7&n|8).toString(16)}),(e||"")+n.replace(/-/g,"").toUpperCase()}function O(e){var t,n;for(t in e)n=e[t],e[t]=n;return(arguments.length>=2?[].slice.call(arguments,1):[]).forEach(function(r){var o;for(t in o=[],r)n=r[t],o.push(e[t]=n);return o}),e}var R=v?function(e,t,n){if(y(e))return e.apply(t,n)}:function(e,t,n){if(y(e))try{return e.apply(t,n)}catch(t){e.toString()}};function D(e){return R(function(){e.setItem("0","0");var t="0"===e.getItem("0");return e.removeItem("0"),t})}function C(e){for(var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n="",r=0;r<t;r+=1)n+=e;return n}function U(e,t,n){return e?e&&e.length>=n?e:e+C(t,Math.ceil(n-e.length)/t.length):e}function w(e,t,n){return function(){var r,o;for(Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]),r=0;r<t.length;r+=1)if(o=t[r],!1===R(o,this,arguments))return;var i=R(e,this,arguments);if(!1===i)return!1;for(r=0;r<n.length;r+=1)o=n[r],R(o,this,arguments);return i}}function M(e){if(!e)return"";var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);return t?t[3]:""}var x=f.document||{},P="hidden"in x?"hidden":"webkitHidden"in x?"webkitHidden":"mozHidden"in x?"mozHidden":"msHidden"in x?"msHidden":null;function V(e,t,n){return[].slice.call(e,t,n)}function G(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?10:arguments[2];return e>=1e21&&(e=9527e16),T.parseInt(e,n)||t}function b(e){return Math.min(99e19,e)}function F(e){try{return e?JSON.stringify(e):null}catch(e){}return null}function H(e){try{return e?JSON.parse(e):null}catch(e){}return null}function k(e){t&&(t.stop(),E(function(){t&&t.reset(e)},e),e&&(p.interval=e))}function X(){t&&(t.cancel(),t=null)}function j(){t&&t.stop()}function B(){t&&t.run()}function K(e,n){t=new function(e,t){var n=this;this.duration=t,this.status="running",this.timer=E(function(){return n.run()},this.duration),this.run=function(){"cancelled"!==n.status&&(m(n.timer),r.attempt(e),n.timer=E(function(){return n.run()},n.duration))},this.stop=function(){n.status="stopped",m(n.timer)},this.reset=function(e){"cancelled"!==n.status&&(n.stop(),e&&(n.duration=e),n.run())},this.cancel=function(){this.status="cancelled",m(this.timer)}}(e,n)}var Y,q=[],Q=0;function z(){if(Y)return Y;if(!((Q+=1)>4)){var e={egret:"egret",layabox:"layabox",cocos:"cc.game",impact:"ig",phaser:"Phaser",pixi:"PIXI",create:"createjs",three:"THREE",gameMaker:"asset_get_type",playCanvas:"pc.fw",turbulenz:"TurbulenzEngine",quintus:"Quintus",melon:"me.game",lychee:"lychee",wade:"wade.addSceneObject",crafty:"Crafty",lime:"lime.Scene",enchant:"enchant",isogenic:"IgeEngine",gameclosure:"GC.Application",panda:"game.Scene",kiwi:"Kiwi",jaws:"jaws",sirius2d:"ss2d",collie:"collie",physics:"Physics",stage:"Stage.Anim",babylon:"BABYLON"};for(var t in e){var n=e[t];if(n.indexOf(".")>-1){var r=n.split("."),o=T[r[0]];if(o&&o[r[1]])return Y=t,t}else if(T[n])return Y=t,t}}}e.version=27;var J=3e4,W=172800,$=40,Z=32,ee=5e3,te=100,ne=0,re=0,oe=0,ie=3,ae=0,ue={accountId:"",accountType:"",age:i.DEFAULT_AGE,appId:"",appVersion:"",brand:"",channel:"",customDeviceId:"",gameServer:"",gender:i.DEFAULT_GENDER,idfa:"",imei:"",lonLat:"",mac:"",netType:i.DEFAULT_NET_TYPE,operator:"",osVersion:"",platform:i.DEFAULT_PLATFORM,resolution:"",roleClass:"",roleId:"",roleLevel:i.DEFAULT_ROLE_LEVEL,roleRace:"",simCardOp:"",uid:"",ver:e.version},se=[],ce=0,ge=i.DEFAULT_PLATFORM,de=T.screen||{},le=de.width&&de.width+"*"+de.height;le||(le="0*0");var pe="",fe="";if(!(T.navigator&&T.navigator.userAgent||"")){var Te=["ios","android"];if(I.layabox){var Ee=T.layabox.getDeviceInfo()||{};le=Ee.resolution||"0*0",fe=Ee.phonemodel,ge=Te.indexOf(Ee.os.toLowerCase()),pe=(Ee.os+" "+Ee.osversion).toLowerCase()}else if(I.cocos){var me=T.cc.view.getViewPortRect()||{};le=me.width+"*"+me.height,ge=Te.indexOf(T.cc.sys.os.toLowerCase())}-1===[0,1,2,3].indexOf(ge)&&(ge=i.DEFAULT_PLATFORM)}var Ie={resolution:le,brand:fe,osVersion:pe,platform:ge};for(var he in Ie)ue[he]=ue[he]||Ie[he];function ve(){var e=p.loginTime||p.initTime;return{loginTime:e,onlineTime:r.parseInt(Date.now()/1e3)-e||1,extendMap:{from:p.from,engine:z()||"",app:p.app}}}function _e(e,t){var n={headerInfo:ue,onlineInfo:ve(),errorInfoList:q.concat(),eventInfoList:se.concat()};return e&&(n.paymentInfo=e),t&&(n.userInfo=t),n}function ye(){se.length=0,q.length=0}var Se="rd.gdatacube.net",Ae="dcagent_create_time",Ne="EGRET",Le="LAYA",Oe="COCOS",Re="UE",De="dcagent_parent_id",Ce="dcagent_client_events",Ue="dcagent_client_errors",we="dcagent_client_id",Me="dcagent_snapshot",xe="dc_p_lo",Pe="/dc/hh5/sync",Ve="0A",Ge="DE_EVENT_OSS",be="appId,appVersion,brand,channel,customDeviceId,idfa,imei,lonLat,mac,netType,operator,osVersion,platform,simCardOp,uid",Fe="accountId,accountType,age,gender,gameServer",He="roleId,roleRace,roleClass,roleLevel",ke="DE_EVENT_COIN_ACTION",Xe="DE_EVENT_ITEM_ACTION",je="DE_EVENT_LEVELUP",Be="DE_EVENT_GUANKA_ACTION",Ke="DE_EVENT_TASK_ACTION",Ye="DE_EVENT_PV",qe={get:function(e){var t="(^|)\\s*"+e+"=([^\\s]*)",n=x.cookie.match(new RegExp(t));return n&&n.length>=3?decodeURIComponent(n[2]):null},set:function(e,t,n,r,o,i){var a;n&&(a=new Date).setTime(a.getTime()+864e5*n);var u=n?" expires="+a.toGMTString():"",s=" path="+(o||"/"),c=r?" domain="+r:"",g=i?" secure":"";x.cookie=e+"="+encodeURIComponent(t)+u+s+c+g},remove:function(e,t,n){qe.set(e,"",-1,t,n)}},Qe=!!T.localStorage||I.isEgret||I.isCocos||I.isLayabox;var ze=function(){if(x&&y(x.createElement)){var e=x.createElement("div");if(!e)return!1;if(y(e.querySelector)){e.innerHTML="<i></i>";var t=e.querySelector("i");return!!t&&"I"===t.tagName}if(y(e.getElementsByTagName)){var n=e.getElementsByTagName("i");return!!n&&1===n.length}}return!1}(),Je=ze&&"cookie"in x,We=f.location||{},$e="https:"===We.protocol?"https:":"http:",Ze=!!T.XDomainRequest,et=s.hasCookie?qe:{get:r.noop,set:r.noop},tt=I.isEgret?T.egret.localStorage:I.isCocos?T.cc.sys.localStorage:Qe?T.localStorage:{getItem:_,setItem:_,removeItem:_};function nt(e){return ue.appId+"."+e}function rt(e,t){e=nt(e),tt.setItem(e,t),et.set(e,t,3650)}function ot(e){return e=nt(e),tt.getItem(e)||et.get(e)}function it(e,t){tt.setItem(nt(e),t)}function at(e){return tt.getItem(nt(e))}function ut(e){tt.removeItem(nt(e))}function st(){u.setItem(a.LOGOUT_TIME,r.parseInt(Date.now()/1e3)),(q.length||se.length)&&u.setItem(a.QUIT_SNAPSHOT,r.jsonStringify(_e()))}function ct(){var e=u.getItem(a.QUIT_SNAPSHOT);return e&&r.jsonParse(e)}function gt(e){ce>=i.MAX_ERROR_COUNT||(q.push(e),ce+=1)}function dt(e){se.push(e)}function lt(e,t){if(e){var i=function(e){return e.replace(/%/g,"_")};arguments.length>2&&(t=arguments[2]);var a={};if(r.isObject(t))for(var u in t)a[i(u)]="number"==typeof t[u]?t[u]:encodeURIComponent(t[u]);var s={eventId:i(e),eventMap:a};return o.addEvent(s),t&&t.immediate?(n.stop(),n.run(),!1):void 0}r.tryThrow("Missing eventId")}var pt,ft=0;function Tt(e){var t=T.egret,n=new t.URLLoader,o=Date.now();n.addEventListener(t.Event.COMPLETE,function(t){var n=Date.now()-o,i=t.target,a="success"===i.data;r.attempt(a?e.success:e.error,i,[i,n,n>=e.timeout]),r.attempt(e.complete,i,[i,n])});var i=new t.URLRequest(e.url);i.method=e.method||t.URLRequestMethod.POST,i.data=r.jsonStringify(e.data),n.load(i)}var Et=s.useXDR?function(){return new T.XDomainRequest}:function(){return new T.XMLHttpRequest};var mt=I.isCocos?function(){return T.cc.loader.getXMLHttpRequest()}:Et;function It(e){var t=mt();pt.timeout&&(t.timeout=e.timeout),t.open(e.method||"POST",e.url,!0),pt.setContentType(t,"text/plain; charset=UTF-8");var n=Date.now();t.onreadystatechange=function(){if(4===this.readyState){var t=this.status>=200&&this.status<300,o=Date.now()-n;r.attempt(t?e.success:e.error,this,[this,o]),r.attempt(e.complete,this,[this,o]),this.onreadystatechange=null,this.ontimeout=null}},pt.timeout&&(t.ontimeout=function(){var t=Date.now()-n;r.attempt(e.error,this,[this,t,!0]),r.attempt(e.complete,this,[this,t]),this.onreadystatechange=null,this.ontimeout=null}),t.send(r.jsonStringify(e.data))}var ht=T.XMLHttpRequest||I.isCocos?(pt=function(){var e=!0,t=!0,n=mt();try{n.timeout=1}catch(t){e=!1}try{n.contentType="text/plain; charset=UTF-8"}catch(e){t=!1}var r=s.useXDR?function(e,n){t&&(e.contentType=n)}:function(e,t){e.setRequestHeader("Content-Type",t)};return{timeout:e,contentType:t,setContentType:r}}(),It):I.isEgret?Tt:(r.log("XMLHttpRequest not found"),r.noop);e.report;var vt=0,_t=Date.now()-i.ASAP_TIMEOUT;function yt(t,o){var a=Date.now();if(!o){if(a-_t<i.ASAP_TIMEOUT)return void r.tryThrow("Request dropped: rate limit");_t=a}vt+=1,e.report=t.data,ht({url:t.url,data:t.data,success:function(e,n){r.attempt(t.success,e,[e,n])},error:function(e,n,o){ft+=1,r.attempt(t.error,e,[e,n,o])},complete:function(e,o){if(r.attempt(t.complete,e,[e,o]),e.getAllResponseHeaders&&e.getResponseHeader){if(-1!==e.getAllResponseHeaders().indexOf("X-Rate-Limit")){var i=r.parseInt(e.getResponseHeader("X-Rate-Limit"));i>1&&n.reset(1e3*i)}}}})}function St(e){if(!e)return!1;var t=e.onlineInfo.onlineTime;return!(t<1||t>i.MAX_ONLINE_TIME)||(r.tryThrow("Illegal online time"),!1)}function At(){if(!p.inited)return r.tryThrow("DCAgent.init needed"),!1}function Nt(){if(!p.loginTime)return r.tryThrow("DCAgent.login needed"),!1}function Lt(){if(p.destroyed)return r.tryThrow("DCAgent is destroyed already"),!1}var Ot,Rt=s.protocol+"//"+a.HOST+a.API_PATH;function Dt(e){return e+"?__deuid="+ue.uid+"&__deappid="+ue.appId}function Ct(e){return e+"?type=h520&appId="+ue.appId+"&uid="+ue.uid+"&mac="+(ue.mac||"")+"&imei="+(ue.imei||"")+"&idfa="+(ue.idfa||"")}function Ut(e,t,n){if(e||!r.hiddenProperty||!x[r.hiddenProperty]){var i={url:g.appendOnline(g.API_PATH)},u=1;vt&&vt%p.oss==0&&(o.addEvent({eventId:a.REQ_KEY,eventMap:{succ:vt-ft,fail:ft,total:vt}}),u+=1),i.data=o.collect(t,n);var s=i.data.eventInfoList[i.data.eventInfoList.length-u];if(s&&s.eventMap&&s.eventMap.immediate&&(e=!0),c.isParamsValid(i.data)){o.clear();var d=i.data.errorInfoList,l=i.data.eventInfoList;(l.length||d.length)&&(i.error=function(){d.forEach(function(e){o.addError(e)}),l.forEach(function(e){o.addEvent(e)})}),yt(i,e)}}}function wt(e){e||(e=i.ASAP_TIMEOUT),m(Ot),n.stop(),Ot=E(function(){n.run()},e)}var Mt={login:function(e){e?ue.accountId!==e?(d.setPollingDebounce(p.interval),Ut(!0),p.loginTime=r.parseInt(Date.now()/1e3),(a.ACCOUNT_RELATED_SETTINGS+","+a.ACCOUNT_ROLE_SETTINGS).split(",").forEach(function(e){return ue[e]=""}),ue.age=i.DEFAULT_AGE,ue.gender=i.DEFAULT_GENDER,ue.roleLevel=i.DEFAULT_ROLE_LEVEL,ue.accountId=e,Ut(!0)):p.loginTime=p.loginTime||r.parseInt(Date.now()/1e3):r.tryThrow("Missing accountID")},getUid:function(){return ue.uid||""},onEvent:lt};function xt(e,t,n,o){var i=arguments;a.ACCOUNT_ROLE_SETTINGS.split(",").forEach(function(e,t){return ue[e]=i[t]||""}),ue.roleLevel=r.parseInt(o)||1}var Pt,Vt={onCoinGet:function(e,t,n,o){if(t=r.parseInt(t),e=r.parseInt(e),t<0||e<0||t<e)return r.tryThrow("Argument error"),!1;lt(a.EVT_COIN,{actionType:"coinGet",coinType:String(n),balanceNum:t,coinNum:e,reason:String(o)})},onCoinUse:function(e,t,n,o){if(t=r.parseInt(t),e=r.parseInt(e),t<0||e<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_COIN,{actionType:"coinUse",coinType:String(n),balanceNum:t,coinNum:e,reason:String(o)})},onItemBuy:function(e,t,n,o,i){if(t=r.parseInt(t),o=r.parseInt(o),t<0||o<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_ITEM,{actionType:"itemBuy",itemId:String(e),itemNum:t,coinType:String(n),coinNum:o,missonID:String(i)})},onItemProduce:function(e,t,n,o){if((t=r.parseInt(t))<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_ITEM,{actionType:"itemGet",itemId:String(e),itemNum:t,reason:String(o),missonID:String(n)})},onItemUse:function(e,t,n,o){if((t=r.parseInt(t))<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_ITEM,{actionType:"itemUse",itemId:String(e),itemNum:t,reason:String(o),missonID:String(n)})},onLevelUp:function(e,t,n){if(e=r.parseInt(e),t=r.parseInt(t),n=r.parseInt(n),e<0||t<0||e>t||n<0)return r.tryThrow("Argument error"),!1;ue.roleLevel=t,lt(a.EVT_LEVEL,{startLevel:e,endLevel:t,duration:n})},onMissionFinished:function(e,t){if((t=r.parseInt(t))<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_MISSION,{actionType:"guankaFinish",guankaId:String(e),duration:t})},onMissionUnfinished:function(e,t){if((t=r.parseInt(t))<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_MISSION,{actionType:"guankaUnfinish",guankaId:String(e),duration:t})},onPayment:function(e){if(e&&e.hasOwnProperty("amount")){var t={currencyAmount:r.max(parseFloat(e.amount,10)||0),currencyType:e.currencyType||"CNY",payType:String(e.payType||""),iapid:String(e.iapid||""),payTime:r.parseInt(Date.now()/1e3),extendMap:{orderId:String(e.orderId||"")}};if(!(t.currencyAmount<=0))return Ut(!0,t),t;r.tryThrow("amount must be greater than 0")}else r.tryThrow("Missing amount")},onTaskFinished:function(e,t){if((t=r.parseInt(t))<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_TASK,{actionType:"taskFinish",taskId:String(e),elapsed:t})},onTaskUnfinished:function(e,t){if((t=r.parseInt(t))<0)return r.tryThrow("Argument error"),!1;lt(a.EVT_TASK,{actionType:"taskUnfinish",taskId:String(e),elapsed:t})},setAccountType:function(e){ue.accountType=String(e)},setAge:function(e){e=r.parseInt(e),ue.age=e>0&&e<128?e:0},setGameServer:function(e){ue.gameServer=String(e)},setGender:function(e){ue.gender=2===e?2:1},setRoleInfo:xt,createRole:function(e,t,n,r){xt(e,t,n,r),lt("DE_EVENT_CREATE_ROLE",{roleId:String(e),roleRace:String(t),roleClass:String(n)})}},Gt=[c.shouldNotBeDestoryed,c.shouldBeInited],bt=[c.shouldNotBeDestoryed,c.shouldBeLoggedIn],Ft=[function(){return d.setPollingDebounce()}];for(Pt in Mt)e[Pt]=r.aspect(Mt[Pt],Gt,"onEvent"===Pt&&Ft);for(Pt in Vt)e[Pt]=r.aspect(Vt[Pt],bt,"onPayment"!==Pt&&Ft);function Ht(e){if(T.addEventListener){var t=function(){for(var e=["pagehide","beforeunload","unload"],t=0;t<e.length;t+=1)if("on"+e[t]in T)return e[t]}();t&&T.addEventListener(t,e)}}function kt(){var e,t,n;try{if(l.engine.layabox){var o=T.layabox.getDeviceInfo()||{};e=(e=o.mac||o.idfa)&&e.replace(/[-_:=\s]+/g,"").toUpperCase()}}catch(t){e=null}return(e=r.padding(e,a.PADDING_STRING,i.UID_MIN_LENGTH))||r.uuid((t=Date.now().toString(36).toUpperCase(),(n=l.engine).egret?a.EGRET_PREFIX+t:n.layabox?a.LAYA_PREFIX+t:n.cocos?a.COCOS_PREFIX+t:a.UNKNOW_ENGINE+t))}function Xt(e){var t=u.getUID(a.CLIENT_KEY),s=t?0:1,c=function(e){if(ue.uid){var t=r.padding(ue.uid,a.PADDING_STRING,i.UID_MIN_LENGTH);e!==t&&(ue.uid=t,e=t,u.setItem(a.CREATE_TIME,r.parseInt(Date.now()/1e3)))}var n=e||kt();return u.setUID(a.CLIENT_KEY,n),n}(t);ue.uid=c,ue.accountId=c,e.errorReport&&T.addEventListener&&T.addEventListener("error",function(e){r.attempt(function(){var t={};["colno","filename","lineno","message"].forEach(function(n){return t[n]=e[n]||"1"});var n=e.error||{};if(t.stack=encodeURIComponent(n.stack||n.stacktrace||""),t.type=n.name||"Error",t.timestamp=parseInt(e.timeStamp/1e3),r.isFunction(p.getErrorScene)){var i=r.attempt(p.getErrorScene,n,[e]);if(i){if(r.isObject(i)){var a="";for(var u in i)a+="\t"+u+"="+i[u]+"\n";i=a}else i=String(i);t.stack+="\n\nError scene:\n"+encodeURIComponent(i)}}o.addError(t)})},!1),p.initTime=r.parseInt(Date.now()/1e3);var d=u.getItem(a.CREATE_TIME);d||(d=p.initTime,u.setItem(a.CREATE_TIME,d)),p.createTime=r.parseInt(d);var l=We.href||"!";o.addEvent({eventId:a.EVT_PV,eventMap:{page:encodeURI(l.split("?")[0])}}),Ut(!0,null,s?{actTime:d,regTime:d}:null),function(e){if(p.storage&&(Ht(o.saveToStorage),!e)){var t=o.loadFromStorage();t&&(yt({url:g.appendOnline(g.API_PATH),data:t},!0),u.removeItem(a.QUIT_SNAPSHOT))}}(s);var f=1e3*Math.max(i.MIN_ONLINE_INTERVAL,parseFloat(e.interval||i.MIN_ONLINE_INTERVAL));n.set(Ut,f),p.interval=f,p.inited=!0}e.init=function(e){if(!1!==c.shouldNotBeDestoryed()){var t=function(e){return p.storage=r.isLocalStorageSupported(u),e.uid||p.storage?p.inited?"Initialization ignored":e&&e.appId?(e.appId=e.appId.toUpperCase(),p.oss="number"==typeof e.oss?e.oss:0,p.getErrorScene=e.getErrorScene,p.app=e.appName||"",p.from=e.from||r.getHostName(x.referrer),void a.USER_INIT_BASE_SETTINGS.split(",").forEach(function(t){e.hasOwnProperty(t)&&(ue[t]=e[t])})):"Missing appId":s.hasStorage?"Storage quota error":"Storage not support"}(e);if(t)return r.tryThrow(t);Xt(e),r.isDebug||yt({url:g.appendEcho(s.protocol+"//"+a.HOST+"/echo"),method:"GET"},!0)}},e.isReady=function(){return p.inited},e.destroy=function(){X(),p.destroyed=!0};var jt=T.DCAgentObject;if(jt){var Bt=T[jt];if(r.isFunction(Bt)){var Kt=Bt.cache;Kt.length&&(Kt.forEach(function(t){r.attempt(e[t[0]],e,r.slice(t,1))}),Kt.length=0)}}var Yt={get isNew(){var e=p.loginTime||p.initTime;return p.createTime===e},get initTime(){return p.initTime},get createTime(){return p.createTime},get loginTime(){return p.loginTime},get lastLogoutTime(){return parseInt(u.getItem(a.LOGOUT_TIME))},get reportCount(){return vt},get reportFailedCount(){return ft}};e.state=p,e.player=Yt});